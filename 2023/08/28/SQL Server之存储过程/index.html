<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="定义 存储过程（Stored Procedure）是使用Transact-SQL语言编写的一段能实现指定功能的程序 用户可以通过存储过程的名称和参数传递调用这些具有指定功能的存储过程 存储过程也是数据库对象  优点 执行速度快，效率高 模块式编程 减少网络流量 安全性  种类 系统存储过程（System Stored Procedures）：一般是以sp_为前缀的 扩展存储过程（Extended">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL Server之存储过程">
<meta property="og:url" content="https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/index.html">
<meta property="og:site_name" content="一只摸鱼王の日常">
<meta property="og:description" content="定义 存储过程（Stored Procedure）是使用Transact-SQL语言编写的一段能实现指定功能的程序 用户可以通过存储过程的名称和参数传递调用这些具有指定功能的存储过程 存储过程也是数据库对象  优点 执行速度快，效率高 模块式编程 减少网络流量 安全性  种类 系统存储过程（System Stored Procedures）：一般是以sp_为前缀的 扩展存储过程（Extended">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-08-27T16:00:00.000Z">
<meta property="article:modified_time" content="2023-08-28T07:17:45.090Z">
<meta property="article:author" content="Sleny">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SQL Server之存储过程</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/Sleny1994">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/09/14/Excel%E9%80%9A%E8%BF%87VBA+Outlook%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/08/24/ASP.NET%20Core%20MVC%20Filter/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&text=SQL Server之存储过程"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&is_video=false&description=SQL Server之存储过程"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQL Server之存储过程&body=Check out this article: https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&name=SQL Server之存储过程&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&t=SQL Server之存储过程"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%8D%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">4.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C"><span class="toc-number">4.2.</span> <span class="toc-text">执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">用户自定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">标量函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">表值函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4"><span class="toc-number">5.3.</span> <span class="toc-text">查看、修改、删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">6.</span> <span class="toc-text">游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">6.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">6.3.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80"><span class="toc-number">6.4.</span> <span class="toc-text">打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD"><span class="toc-number">6.5.</span> <span class="toc-text">关闭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-1"><span class="toc-number">6.6.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">6.7.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.8.</span> <span class="toc-text">示例</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        SQL Server之存储过程
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Sleny</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-08-27T16:00:00.000Z" class="dt-published" itemprop="datePublished">2023-08-28</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/SQL/">SQL</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/SQL/" rel="tag">SQL</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><ul>
<li>存储过程（Stored Procedure）是使用Transact-SQL语言编写的一段能实现指定功能的程序</li>
<li>用户可以通过存储过程的名称和参数传递调用这些具有指定功能的存储过程</li>
<li>存储过程也是数据库对象</li>
</ul>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li>执行速度快，效率高</li>
<li>模块式编程</li>
<li>减少网络流量</li>
<li>安全性</li>
</ul>
<h2 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h2><ul>
<li>系统存储过程（System Stored Procedures）：一般是以<code>sp_</code>为前缀的</li>
<li>扩展存储过程（Extended Stored Procedures）：一般是以<code>xp_</code>为前缀的，不存储在SQL Server中，而是以dll形式单独存在</li>
<li>用户自定义存储过程（User-defined Stored Procedures）：由用户自行创建的存储过程，可以输入参数，向客户端返回表格或结果、消息等，也可以返回输出参数。<ul>
<li>Transact-SQL存储过程</li>
<li>CLR存储过程：是.NET Framework公共语言时（CLR）方法的引用</li>
</ul>
</li>
</ul>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">CREATE</span> &#123; PROC｜<span class="keyword">PROCEDURE</span> &#125;</span><br><span class="line">     [schema_name.] procedure_name [ ; number ]          <span class="comment">--架构名。存储过程名[;分组]</span></span><br><span class="line">     [ &#123; <span class="variable">@parameter</span> [ type_schema_name. ] data_type &#125;     <span class="comment">--参数</span></span><br><span class="line">       [ <span class="type">VARYING</span> ] [ <span class="operator">=</span> <span class="keyword">default</span> ] [ [ <span class="keyword">OUT</span> [ PUT ]         <span class="comment">--作为游标输出参数</span></span><br><span class="line">     ] [ ,...n ]</span><br><span class="line"> [ <span class="keyword">WITH</span> <span class="operator">&lt;</span>procedure_option<span class="operator">&gt;</span> [ ,...n ]</span><br><span class="line"> [ <span class="keyword">FOR</span> REPLICATION ]                    <span class="comment">--不能在订阅服务器上执行为复制创建的存储过程</span></span><br><span class="line"> <span class="keyword">AS</span> &#123; <span class="operator">&lt;</span>sql_statement<span class="operator">&gt;</span> [;][ ...n ]       <span class="comment">--存储过程语句</span></span><br><span class="line">｜<span class="operator">&lt;</span>method_specifier<span class="operator">&gt;</span> &#125;</span><br><span class="line"> [;]</span><br><span class="line"> <span class="operator">&lt;</span>procedure_option<span class="operator">&gt;</span> ::<span class="operator">=</span></span><br><span class="line">     [ ENCRYPTION ]                      <span class="comment">--加密</span></span><br><span class="line">     [ RECOMPILE ]                       <span class="comment">--不预编译</span></span><br><span class="line">     [ EXECUTE_AS_Clause ]      <span class="comment">--执行存储过程的安全上下文</span></span><br><span class="line"> <span class="operator">&lt;</span>sql_statement<span class="operator">&gt;</span> ::<span class="operator">=</span></span><br><span class="line"> &#123; [ <span class="keyword">BEGIN</span> ] statements [ <span class="keyword">END</span> ] &#125;                        <span class="comment">--存储过程语句</span></span><br><span class="line"> <span class="operator">&lt;</span>method_specifier<span class="operator">&gt;</span> ::<span class="operator">=</span></span><br><span class="line"> <span class="keyword">EXTERNAL</span> NAME assembly_name.class_name.method_name      <span class="comment">--指定程序集方法</span></span><br></pre></td></tr></table></figure>
<ul>
<li>schema_name：架构名</li>
<li>procedure_name：存储过程名</li>
<li>number：对同名过程进行分组的选项，使用drop procedure语句可以将这些分组过程一起删除</li>
<li>@parameter：存储过程的参数,@为局部变量，@@为全局变量</li>
<li>[ type_schema_name. ] data_type：参数的架构及类型，OUTPUT关键字用于指定输出参数</li>
<li>VARYING：指定作为输出参数支持的结果集，仅适用于cursor参数</li>
<li>default：参数的默认值，如果定义了default值，则无须指定此参数的值也可执行存储过程</li>
<li>OUTPUT：输出参数，此选项的值可以返回给调用存储过程的语句</li>
<li>ENCRYPTION：加密存储过程</li>
<li>RECOMPILE：指明该存储过程在运行时才编译，不预编译</li>
<li>EXECUTE_AS_Clause：指定执行存储过程的安全上下文</li>
<li>FOR REPLICATION：不能在订阅服务器上执行为复制创建的存储过程</li>
<li><sql_statement>语法块：存储过程执行的T-SQL语句</li>
<li><method_specifier>语法块：指定.NET Framework程序集的方法，以便CLR存储过程引用</li>
</ul>
<h3 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> [ [ <span class="keyword">EXEC</span> [ UTE ] ]</span><br><span class="line">&#123;</span><br><span class="line">[ <span class="variable">@return_status</span> <span class="operator">=</span> ]</span><br><span class="line">&#123; procedure_name [ ;number ]｜<span class="variable">@procedure_name_var</span></span><br><span class="line">&#125;</span><br><span class="line">[ [ <span class="variable">@parameter</span> <span class="operator">=</span> ] &#123; <span class="keyword">value</span>｜<span class="variable">@variable</span> [ OUTPUT ]｜[ <span class="keyword">DEFAULT</span> ] &#125;</span><br><span class="line">[ ,...n ]</span><br><span class="line">[ <span class="keyword">WITH</span> RECOMPILE ]</span><br></pre></td></tr></table></figure>
<ul>
<li>@return_status：是一个可选的整型变量，保存存储过程的返回状态，这个变量在用于EXECUTE语句前，必须在批处理、存储过程或函数中声明过</li>
<li>@procedure_name_var：是局部定义变量名，代表存储过程名称</li>
</ul>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> ...</span><br></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> procedure_name</span><br></pre></td></tr></table></figure>

<h2 id="用户自定义函数"><a href="#用户自定义函数" class="headerlink" title="用户自定义函数"></a>用户自定义函数</h2><h3 id="标量函数"><a href="#标量函数" class="headerlink" title="标量函数"></a>标量函数</h3><ul>
<li>函数的返回值为标量数据类型<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [ owner_name.] function_name</span><br><span class="line">( [ &#123; <span class="variable">@parameter_name</span> [<span class="keyword">AS</span>] scalar_parameter_data_type [ <span class="operator">=</span> <span class="keyword">default</span> ] &#125; [ ,...n ] ] )</span><br><span class="line"><span class="keyword">RETURNS</span> scalar_return_data_type</span><br><span class="line">[ <span class="keyword">WITH</span> <span class="operator">&lt;</span> function_option<span class="operator">&gt;</span> [ [,] ...n] ]</span><br><span class="line">[ <span class="keyword">AS</span> ]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  function_body</span><br><span class="line">  <span class="keyword">RETURN</span> scalar_expression</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure></li>
<li>owner_name：拥有该用户定义函数的用户名称。owner_name必须是已有的用户ID。</li>
<li>function_name：用户定义函数的名称。函数名称必须符合标识符的规则，对其所有者来说，该名称在数据库中必须唯一。</li>
<li>@parameter_name：用户定义函数的参数名。CREATE FUNCTION语句中可以声明一个或多个参数。函数最多可以有1024个参数。函数执行时每个已声明参数的值必须由用户指定，除非已经定义了该参数的默认值。如果函数的参数有默认值，在调用该函数时必须指定“default”关键字才能获得默认值。这种行为不同于存储过程中有默认值的参数，在存储过程中省略参数也意味着使用默认值。</li>
<li>scalar_parameter_data_type：参数的数据类型。所有标量数据类型（包括bigint和sql_variant）都可用做用户定义函数的参数。不支持timestamp数据类型和用户定义数据类型。不能指定非标量类型（例如cursor和table）。</li>
<li>scalar_return_data_type：函数返回值的数据类型。scalar_return_data_type可以是SQL Server支持的任何标量数据类型（text、ntext、image和timestamp除外）。</li>
<li>ENCRYPTION：指出SQL Server加密包含CREATE FUNCTION语句文本的系统表列。使用ENCRYPTION可以避免将函数作为SQL Server复制的一部分发布。</li>
<li>SCHEMABINDING：指定将函数绑定到它所引用的数据库对象上。如果函数是用SCHEMABINDING选项创建的，则不能更改（使用ALTER语句）或除去（使用DROP语句）该函数引用的数据库对象。</li>
<li>function_body：由多条Transact-SQL语句组成的函数体。</li>
<li>scalar_expression：用户定义函数要返回的标量值表达式。</li>
</ul>
<h3 id="表值函数"><a href="#表值函数" class="headerlink" title="表值函数"></a>表值函数</h3><ul>
<li>函数返回值为TABLE（表）</li>
</ul>
<ol>
<li>内嵌表值函数<ul>
<li>RETURNS自居指定的TABLE不附带字段列表，则该函数为内嵌函数</li>
<li>由单个SELECT语句定义，该函数返回的表的字段（包括数据类型）来自定义该函数的SELECT语句的字段列表 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [ owner_name.] function_name</span><br><span class="line">( [ &#123; <span class="variable">@parameter_name</span> [<span class="keyword">AS</span>] scalar_parameter_data_type [ <span class="operator">=</span> <span class="keyword">default</span> ] &#125; [ ,...n ] ] )</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">TABLE</span></span><br><span class="line">[ <span class="keyword">WITH</span> <span class="operator">&lt;</span> function_option <span class="operator">&gt;</span> [ [,] ...n ] ]</span><br><span class="line">[ <span class="keyword">AS</span> ]</span><br><span class="line"><span class="keyword">RETURN</span> [ ( ) <span class="keyword">select</span><span class="operator">-</span>stmt [ ] ]</span><br></pre></td></tr></table></figure></li>
<li>TABLE：指定返回值为TABLE（表）</li>
<li>select-stmt：单条SELECT语句</li>
</ul>
</li>
<li>多语句表值函数<ul>
<li>RETURNS子句指定的TABLE类型带有字段及其数据类型</li>
<li>多语句函数的主体中允许使用多种语句<ul>
<li>赋值语句</li>
<li>控制流语句</li>
<li>DECLARE语句，该语句定义函数局部的数据变量和游标</li>
<li>SELECT语句，该语句包含带有表达式的选择列表，其中的表达式将值赋予函数的局部变量</li>
<li>游标操作，该操作引用在函数中声明、打开、关闭和释放的局部游标。只允许使用以INTO子句向局部变量赋值的FETCH语句；不允许使用将数据返回到客户端的FETCH语句</li>
<li>INSERT、UPDATE、DELETE语句，这些语句修改函数的局部table类型的变量</li>
<li>调用存储过程的EXECUTE语句 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [ owner_name.] function_name</span><br><span class="line">( [ &#123; <span class="variable">@parameter_name</span> [<span class="keyword">AS</span>] scalar_parameter_data_type [ <span class="operator">=</span> <span class="keyword">default</span> ] &#125; [ ,...n ] ] )</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="variable">@return_variable</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span> table_type_definition <span class="operator">&gt;</span></span><br><span class="line">[ <span class="keyword">WITH</span> <span class="operator">&lt;</span> function_option <span class="operator">&gt;</span> [ [,] ...n] ]</span><br><span class="line">[ <span class="keyword">AS</span> ]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  function_body</span><br><span class="line">  <span class="keyword">RETURN</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>@return_variable：table类型的变量。当调用程序调用函数时，函数返回的就是该变量的值</li>
</ul>
</li>
</ol>
<h3 id="查看、修改、删除"><a href="#查看、修改、删除" class="headerlink" title="查看、修改、删除"></a>查看、修改、删除</h3><ol>
<li>查看<ul>
<li>用户自定义函数的定义存放在sys.sql_modules视图中，在sys.sql_modules中就可以查看到所有用户自定义的函数</li>
</ul>
</li>
<li>修改<ul>
<li>修改用户自定义函数使用的是ALTER FUNCTION语句，其他的语法与创建用户自定义函数一样，但是使用ALTER FUNCTION命令不能更改用户自定义函数的类型，例如不能将标量函数更改为内联表值函数或者多语句表值函数</li>
</ul>
</li>
<li>删除 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> &#123; [ owner_name .] function_name &#125; [ ,...n ]</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>游标是类似C语言指针的一种结构，它包含结果集和结果集中指向记录的游标位置两部分，游标作为指针来遍历结果集（每次指向一行），可以理解游标是一个数据缓冲区，它存放了查询结果，而用户则可以利用SQL语句从这个缓冲区中提取数据。</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>游标允许开发者从多条数据记录的结果集中每次提取一条记录，从而使用户能够更加灵活地处理SQL操作当中返回的结果集。例如：通常使用的SELECT查询语句，可以返回一个结果集合，而用户则需要从结果集中逐一地读取每条记录，此时就可以利用游标来完成这项操作。</p>
<p>在利用SQL语句处理数据时可以对所有符合条件的数据进行操作，而很多时候则需要对这些符合条件的数据进行逐条的操作，这种操作如果没有游标则会由前端的高级编程语言完成，这样做不仅浪费了程序所在服务器的资源，也浪费了网络资源，使得整个数据操作周期增加，用户体验下降。而通过游标则可以有效地在数据库服务器上解决此类问题。<br>允许从当前行检索一行或多行数据。</p>
<p>主要功能操作：</br></p>
<ul>
<li>允许操作当前行的数据，这也是最常用的游标使用方式。</li>
<li>可以定位在特定的行。</li>
</ul>
<p>固定的步骤：</br></p>
<ul>
<li>创建游标，游标在使用前必须创建，创建游标时允许定义相关的特性。</li>
<li>执行游标，利用查询语句来完成对游标的填充。</li>
<li>遍历结果集，当游标被数据填充后，可以利用命令来对游标中的数据进行遍历操作，也就是检索游标中的数据。</li>
<li>对检索当前行的数据进行操作，例如修改数据等。</li>
<li>关闭游标，对游标的操作完成后需要关闭游标，以释放相关资源。</li>
</ul>
<p>【注】：结果集指的是查询的结果，它可以是多行，也可以是0行，多行时可以利用游标遍历结果，而0行时，游标则没有执行的必要。</p>
<h3 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> cursor_name [ <span class="keyword">INSENSITIVE</span> ] [ <span class="keyword">SCROLL</span> ] <span class="keyword">CURSOR</span></span><br><span class="line"><span class="keyword">FOR</span> select_statement</span><br><span class="line">[<span class="keyword">FOR</span> &#123; READ <span class="keyword">ONLY</span>｜<span class="keyword">UPDATE</span> [ <span class="keyword">OF</span> column_name [ ,...n ]]&#125;]</span><br></pre></td></tr></table></figure>
<ul>
<li>DECLARE：关键词，声明游标。</li>
<li>cursor_name：创建的游标的名称。</li>
<li>INSENSITIVE：表示创建的游标中的数据是基础表中的数据副本，该游标不允许修改，如果省略该关键词，那么从游标中提取的数据被修改后将作用在基础表中。</li>
<li>SCROLL：表示游标的所有相关操作方式被允许，包括FIRST、LAST、NEXT、RELATIVE等，如果省略该项，那么游标的操作将只有NEXT被允许，如果指定了FAST_FORWARD项，则SCROLL将不能被使用。</li>
<li>select_statement：查询语句，用来提供游标结果集，该查询语句有一定的限制，不允许使用INTO、COMPUTE、COMPUTE BY等关键词。</li>
<li>FOR：关键词。</li>
<li>READ ONLY：表示游标只读，不允许通过游标来修改数据。</li>
<li>UPDATE：表示指定游标可以修改的列，[ OF column_name [ ,…n ]]将指定具体允许被修改的列名，如果只有UPDATE关键词，则表示所有列都允许被更新。</li>
</ul>
<h3 id="打开"><a href="#打开" class="headerlink" title="打开"></a>打开</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span></span><br><span class="line">&#123;&#123;[<span class="keyword">GLOBAL</span>]cursor_name &#125;｜cursor_variable_name&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>OPEN：打开游标的关键词。</li>
<li>GLOBAL：指定该游标是全局的游标，如果没有该项，则表示要打开的游标是局部的游标。</li>
<li>cursor_name：指定打开游标的名称，如果全局游标和局部游标名称相同，则需要GLOBAL来指定打开的对象。</li>
<li>cursor_variable_name：表示一个游标变量的名称，这一项表示允许打开一个游标变量。</li>
<li>变量@@CURSOR_ROWS用于获得游标中记录数，该变量可以有4个返回值，代表的含义如下：<ul>
<li>-m：表示当前行数，游标被异步填充。</li>
<li>-1：表示游标为动态游标，动态游标反映当前数据的更改情况，由于数据不断更改，因此此时游标不可能得到所有符合要求的数据。</li>
<li>0：此时表示没有符合要求的数据，游标没有打开或已经关闭释放资源。</li>
<li>n：游标正常查询数据，n表示游标中的记录数。15.7.4 得到游标中的数据</li>
</ul>
</li>
<li>游标得到的是一个数据集，SQL语句没有办法对数据集进行操作，因此，需要利用FETCH来遍历提取结果集中的数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FETCH</span></span><br><span class="line">        [ [ NEXT｜PRIOR｜<span class="keyword">FIRST</span>｜<span class="keyword">LAST</span></span><br><span class="line">            ｜ABSOLUTE &#123; n｜<span class="variable">@nvar</span> &#125;</span><br><span class="line">            ｜RELATIVE &#123; n｜<span class="variable">@nvar</span> &#125;</span><br><span class="line">          ]</span><br><span class="line">          <span class="keyword">FROM</span></span><br><span class="line">        ]</span><br><span class="line">&#123; &#123; [ <span class="keyword">GLOBAL</span> ] cursor_name &#125;｜<span class="variable">@cursor_variable_name</span> &#125;</span><br><span class="line">[ <span class="keyword">INTO</span> <span class="variable">@variable_name</span> [ ,...n ] ]</span><br></pre></td></tr></table></figure></li>
<li>FETCH：检索数据的关键词。</li>
<li>NEXT：用来返回结果集当前行的下一行，是默认的提取项。</li>
<li>PRIOR：返回结果集中当前行的前一行，需要说明的是，当从结果集中读取数据时，第一次使用该选项，将无记录返回。</li>
<li>FIRST：指针返回游标中的第一行并将其作为当前行。</li>
<li>LAST：指针返回游标中的最后一行并将其作为当前行。</li>
<li>ABSOLUTE { n｜@nvar }：假如n或者@nvar参数为正，则表示返回从游标开始位置的第n行，并将第n行作为当前行。如果n或@nvar为负数，则返回从游标末尾开始的第n行，并将返回的这一行作为当前行。</li>
<li>RELATIVE { n｜@nvar}：假如n或@nvar为正数，则返回从当前行开始的第n行，并将返回行变成做为当前行。如果n或@nvar为负数，则返回当前行之前的第n行，并将返回行作为当前行。</li>
<li>FROM：关键词。</li>
<li>GLOBAL：指定游标为全局游标。</li>
<li>cursor_name：游标名称。</li>
<li>@cursor_variable_name：指游标变量名称。</li>
<li>INTO：关键词，表示存入。</li>
<li>@variable_name：变量，它们将接收提取的列数据，要求列表中的各个变量从左到右与游标结果集中的相应列相对应，要求变量的数据类型与相应的结果集列的数据类型匹配，或支持隐式的数据类型转换，除此之外，还要求变量的数量与游标选择列表中的列数相同。<br>【注】：默认情况下NEXT是唯一受支持的FETCH选项，除非在DECLARE CURSOR语句中指定SCROLL选项，NEXT支持游标指针指向下一行。</li>
</ul>
<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>当游标使用完毕后，利用CLOSE关键词关闭游标，以释放游标锁定的行，而CLOSE会保留数据结构，从而使得游标可以重新打开，如果需要释放游标占用的数据结构，则利用DEALLOCATE语句完成。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CLOSE</span> &#123; &#123; [ <span class="keyword">GLOBAL</span> ] cursor_name &#125;｜cursor_variable_name &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>CLOSE：关键词，表示关闭游标操作。</li>
<li>GLOBAL：指明游标为全局游标，而不是局部游标。</li>
<li>cursor_name：游标名称。</li>
<li>cursor_variable_name：游标变量名称。</li>
<li>当利用FETCH NEXT遍历游标中的数据时，需要使用@@FETCH_STATUS全局变量检测FETCH操作的状态，可以方便地得知数据是否已经到最后一行，是否操作成功。该变量具有以下几个返回值:<ul>
<li>0：表示FETCH成功执行。</li>
<li>-1：表示FETCH执行失败。</li>
<li>2：表示读取的数据已经不存在。</li>
</ul>
</li>
</ul>
<p>【注】：CLOSE只允许作用在打开的游标上，而仅有游标声明或关闭的游标则不能使用该关键语句。</p>
<h3 id="修改-1"><a href="#修改-1" class="headerlink" title="修改"></a>修改</h3><p>要修改游标中的数据则需要指明游标非只读，游标除了使用FOR READ ONLY关键字指明其只读外，在查询语句中使用ORDER BY、DISTINCT等关键词也会使游标只读。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line">&#123;<span class="keyword">SET</span> col_name <span class="operator">=</span> expression &#125;[,...n]</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">CURRENT</span> <span class="keyword">OF</span> cursor_name</span><br></pre></td></tr></table></figure>
<ul>
<li>UPDATE：关键词，表示修改。</li>
<li>table_name：表名，指需要修改列的所属表名称。</li>
<li>SET：关键词。</li>
<li>col_name：准备修改的列名。</li>
<li>expression：数值或表达式，修改后的值。</li>
<li>WHERE CURRENT OF：关键词，表示指针所在的当前记录行。</li>
<li>cursor_name：游标名称。</li>
</ul>
<h3 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">CURRENT</span> <span class="keyword">OF</span> cursor_name</span><br></pre></td></tr></table></figure>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用数据库AdventureWorks</span></span><br><span class="line">  USE AdventureWorks</span><br><span class="line">  GO</span><br><span class="line"></span><br><span class="line">  <span class="keyword">DECLARE</span> ATriTest_Cusor <span class="keyword">CURSOR</span>      <span class="comment">--声明创建游标</span></span><br><span class="line">  <span class="keyword">FOR</span></span><br><span class="line">  <span class="keyword">SELECT</span> id,name <span class="keyword">FROM</span> ATriTest       <span class="comment">--游标绑定查询语句</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> id </span><br><span class="line"> <span class="keyword">OPEN</span> ATriTest_Cusor                    <span class="comment">--打开游标</span></span><br><span class="line">  <span class="keyword">DECLARE</span> <span class="variable">@Id</span> <span class="type">INT</span>, <span class="variable">@Name</span> <span class="type">VARCHAR</span>(<span class="number">10</span>)     <span class="comment">--声明变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出，利用CAST函数把int类型转换成varchar类型，以便正常输出，@@CURSOR_ROWS能获取游标记录数 </span></span><br><span class="line">  PRINT<span class="string">&#x27;游标结果集中的记录总数为：&#x27;</span><span class="operator">+</span><span class="built_in">CAST</span>(@<span class="variable">@CURSOR_ROWS</span> <span class="keyword">AS</span> <span class="type">varchar</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 利用FETCH NEXT获取当前行数据存入变量当中，并把指针移动到下一行 </span></span><br><span class="line">  <span class="keyword">FETCH</span> NEXT <span class="keyword">FROM</span> ATriTest_Cusor <span class="keyword">INTO</span> <span class="variable">@ID</span>,<span class="variable">@Name</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">-- 检查Check @@FETCH_STATUS变量，查看FETCH命令是否成功执行</span></span><br><span class="line">  WHILE @<span class="variable">@FETCH_STATUS</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">     <span class="comment">--输出当前行的记录</span></span><br><span class="line">     PRINT <span class="string">&#x27;ID：&#x27;</span><span class="operator">+</span><span class="built_in">CAST</span>(<span class="variable">@ID</span> <span class="keyword">AS</span> <span class="type">char</span>(<span class="number">4</span>))<span class="operator">+</span><span class="string">&#x27; 姓名：&#x27;</span><span class="operator">+</span><span class="variable">@Name</span></span><br><span class="line">     <span class="comment">--定位到下一行的记录</span></span><br><span class="line">     <span class="keyword">FETCH</span> NEXT <span class="keyword">FROM</span> ATriTest_Cusor <span class="keyword">INTO</span> <span class="variable">@ID</span>,<span class="variable">@Name</span></span><br><span class="line">  <span class="keyword">END</span> <span class="comment">--结束</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">CLOSE</span> ATriTest_Cusor          <span class="comment">--关闭游标</span></span><br><span class="line">  <span class="keyword">DEALLOCATE</span> ATriTest_Cusor     <span class="comment">--释放</span></span><br><span class="line">  GO</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/Sleny1994">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%8D%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">4.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C"><span class="toc-number">4.2.</span> <span class="toc-text">执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">用户自定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">标量函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">表值函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4"><span class="toc-number">5.3.</span> <span class="toc-text">查看、修改、删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">6.</span> <span class="toc-text">游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">6.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">6.3.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80"><span class="toc-number">6.4.</span> <span class="toc-text">打开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD"><span class="toc-number">6.5.</span> <span class="toc-text">关闭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-1"><span class="toc-number">6.6.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">6.7.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.8.</span> <span class="toc-text">示例</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&text=SQL Server之存储过程"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&is_video=false&description=SQL Server之存储过程"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQL Server之存储过程&body=Check out this article: https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&title=SQL Server之存储过程"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&name=SQL Server之存储过程&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sleny1994.github.io/2023/08/28/SQL%20Server%E4%B9%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/&t=SQL Server之存储过程"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2023
    Sleny
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/Sleny1994">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
